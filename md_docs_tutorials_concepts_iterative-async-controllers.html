<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Iterative and Async Controllers | OkapiLib A PROS library for programming VEX robots.</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="logo-doxygen.jpeg" type="image/jpeg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OkapiLib <span class="m-thin">A PROS library for programming VEX robots.</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path d="m6 0c-3.3144 0-6 2.6856-6 6 0 3.3144 2.6856 6 6 6 1.4858 0 2.8463-0.54083 3.8945-1.4355-0.0164 0.33797 0.14734 0.75854 0.5 1.1504l3.2227 3.7891c0.55185 0.6139 1.4517 0.66544 2.002 0.11524 0.55022-0.55022 0.49866-1.4501-0.11524-2.002l-3.7891-3.2246c-0.39184-0.35266-0.81242-0.51469-1.1504-0.5 0.89472-1.0482 1.4355-2.4088 1.4355-3.8945 0-3.3128-2.6856-5.998-6-5.998zm0 1.5625a4.4375 4.4375 0 0 1 4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375-4.4375 4.4375 4.4375 0 0 1 4.4375-4.4375z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <path d="m6 0c-3.3144 0-6 2.6856-6 6 0 3.3144 2.6856 6 6 6 1.4858 0 2.8463-0.54083 3.8945-1.4355-0.0164 0.33797 0.14734 0.75854 0.5 1.1504l3.2227 3.7891c0.55185 0.6139 1.4517 0.66544 2.002 0.11524 0.55022-0.55022 0.49866-1.4501-0.11524-2.002l-3.7891-3.2246c-0.39184-0.35266-0.81242-0.51469-1.1504-0.5 0.89472-1.0482 1.4355-2.4088 1.4355-3.8945 0-3.3128-2.6856-5.998-6-5.998zm0 1.5625a4.4375 4.4375 0 0 1 4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375 4.4375 4.4375 4.4375 0 0 1-4.4375-4.4375 4.4375 4.4375 0 0 1 4.4375-4.4375z"/>
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          Iterative and Async Controllers
        </h1>
<p>OkapiLib provides two main types of feedback controllers, <strong>Iterative Controllers</strong> and <strong>Async Controllers</strong>. The two both accomplish the same end goal -- controlling a given system -- but in different manners that makes them tailored for different applications. You can achieve the same response from a system with either option, but one will likely be better than the other for your particular preference with code organization.</p><h3>Iterative Controllers</h3><p><strong>Iterative Controllers</strong> operate <strong>discretely</strong>, meaning that an Iterative Controller will produce an output for the given input <em>at a single point in time</em>. If you want to execute a full movement for a system with an <a href="classokapi_1_1IterativeController.html" class="m-doc">IterativeController</a>, you will need to write a loop that runs <a href="classokapi_1_1IterativeController.html#a751bcad1407099e629e3ffbe395daf2b" class="m-doc">IterativeController::<wbr />step</a> repeatedly until the movement is finished.</p><p>An example movement:</p><pre class="m-code"><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">kP</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kI</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kD</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">exampleController</span> <span class="o">=</span> <span class="n">IterativeControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">kP</span><span class="p">,</span> <span class="n">kI</span><span class="p">,</span> <span class="n">kD</span><span class="p">);</span>
<span class="n">Motor</span> <span class="nf">exampleMotor</span><span class="p">(</span><span class="n">MOTOR_PORT</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Execute the movement</span>
  <span class="n">exampleController</span><span class="p">.</span><span class="n">setTarget</span><span class="p">(</span><span class="n">TARGET</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">exampleController</span><span class="p">.</span><span class="n">isSettled</span><span class="p">())</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">newInput</span> <span class="o">=</span> <span class="n">exampleMotor</span><span class="p">.</span><span class="n">getPosition</span><span class="p">();</span>
    <span class="kt">double</span> <span class="n">newOutput</span> <span class="o">=</span> <span class="n">exampleController</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">newInput</span><span class="p">);</span>
    <span class="n">exampleMotor</span><span class="p">.</span><span class="n">controllerSet</span><span class="p">(</span><span class="n">newOutput</span><span class="p">);</span>

    <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// Run the control loop at 10ms intervals</span>
  <span class="p">}</span>
<span class="p">}</span></pre><h3>Async Controllers</h3><p><strong>Async Controllers</strong> were given their name because they can operate <strong>asynchronously</strong> to one another, which means practically that you can have multiple movements by multiple controllers operating at the same time easily. Each <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController</a> operates in its own task, so starting a movement for one <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController</a> won&#x27;t prevent another <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController</a> (or <a href="classokapi_1_1IterativeController.html" class="m-doc">IterativeController</a>) from running immediately thereafter.</p><p>You don&#x27;t need to run a loop to generate and set the controller output like with an <a href="classokapi_1_1IterativeController.html" class="m-doc">IterativeController</a>, and blocking further movements until an <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController&#x27;s</a> movement is done is as simple as a call to <a href="classokapi_1_1AsyncController.html#a20e19f334e3dc7a3092e0e4355edcf49" class="m-doc">AsyncController::<wbr />waitUntilSettled</a>.</p><p>An example movement:</p><pre class="m-code"><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">kP</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kI</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kD</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">exampleController</span> <span class="o">=</span> <span class="n">AsyncPosControllerBuilder</span><span class="p">()</span>
                           <span class="p">.</span><span class="n">withMotor</span><span class="p">(</span><span class="n">MOTOR_PORT</span><span class="p">)</span>
                           <span class="p">.</span><span class="n">withGains</span><span class="p">({</span><span class="n">kP</span><span class="p">,</span> <span class="n">kI</span><span class="p">,</span> <span class="n">kD</span><span class="p">})</span>
                           <span class="p">.</span><span class="n">build</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Execute the movement</span>
  <span class="n">exampleController</span><span class="o">-&gt;</span><span class="n">setTarget</span><span class="p">(</span><span class="n">TARGET</span><span class="p">);</span>
  <span class="n">exampleController</span><span class="o">-&gt;</span><span class="n">waitUntilSettled</span><span class="p">();</span>
<span class="p">}</span></pre><h3>When Should I Use Which Controller?</h3><p>Async Controllers are obviously the easiest to work with for normal movements, as seen in the above example code. If you just want to run a system or systems in the manner shown in the examples, that&#x27;s probably your best choice. If you want to collect extra data during the movement (such as motor stats like current, temperature, etc.), then you will need to use an Iterative Controller to collect that data. Additionally, if you want to use the output from two controllers to set the output for your system (i.e. running both a heading PID and a forward/backward PID on a drivetrain), the using two Iterative Controllers would be the best idea.</p><p>To conclude, for most applications an <a href="classokapi_1_1AsyncController.html" class="m-doc">AsyncController</a> should suffice, but if you want more complex behavior, then use an <a href="classokapi_1_1IterativeController.html" class="m-doc">IterativeController</a>.</p>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>OkapiLib A PROS library for programming VEX robots.. Created with <a href="https://doxygen.org/">Doxygen</a> 1.8.13 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
